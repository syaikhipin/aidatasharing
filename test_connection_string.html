<!DOCTYPE html>
<html>
<head>
    <title>Test Connection String Generation</title>
</head>
<body>
    <h1>Test Connection String Generation</h1>
    
    <script>
        const generateConnectionString = (dataset, token) => {
            const host = typeof window !== 'undefined' ? window.location.hostname : 'localhost';
            const proxyHost = `${host}:${getPortForType(dataset.file_type)}`;
            const encodedDatasetName = encodeURIComponent(dataset.dataset_name);
            
            switch (dataset.file_type?.toLowerCase()) {
                case 'mysql':
                    return `mysql://proxy_user:${token}@${proxyHost}/${encodedDatasetName}`;
                case 'postgresql':
                    return `postgresql://proxy_user:${token}@${proxyHost}/${encodedDatasetName}`;
                case 'clickhouse':
                    return `clickhouse://proxy_user:${token}@${proxyHost}/${encodedDatasetName}`;
                case 's3':
                    return `s3://${proxyHost}/${encodedDatasetName}?access_key=proxy_user&secret_key=${token}`;
                case 'mongodb':
                    return `mongodb://proxy_user:${token}@${proxyHost}/${encodedDatasetName}`;
                case 'api':
                    return `http://${proxyHost}/api/${encodedDatasetName}?token=${token}`;
                default:
                    return `http://${proxyHost}/${encodedDatasetName}?token=${token}`;
            }
        };

        const getPortForType = (fileType) => {
            switch (fileType?.toLowerCase()) {
                case 'mysql':
                    return '10101';
                case 'postgresql':
                    return '10102';
                case 'clickhouse':
                    return '10104';
                case 'mongodb':
                    return '10105';
                case 's3':
                    return '10106';
                case 'api':
                    return '10103';
                default:
                    return '10103';
            }
        };

        // Test the function
        const testDataset = {
            dataset_name: 'Animal Facts Knowledge Base',
            file_type: 'api'
        };
        
        const token = '8241cee9ec82ceb84e6d4e9b524dd754';
        const connectionString = generateConnectionString(testDataset, token);
        
        console.log('Generated connection string:', connectionString);
        document.body.innerHTML += `<p><strong>Generated connection string:</strong><br><code>${connectionString}</code></p>`;
        
        // Should output: http://localhost:10103/api/Animal%20Facts%20Knowledge%20Base?token=8241cee9ec82ceb84e6d4e9b524dd754
    </script>
</body>
</html>